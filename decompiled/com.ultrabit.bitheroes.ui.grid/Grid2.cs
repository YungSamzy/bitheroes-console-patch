using System;
using System.Collections.Generic;
using com.ultrabit.bitheroes.core;
using com.ultrabit.bitheroes.model.grid;
using TMPro;
using UnityEngine;
using UnityEngine.EventSystems;

namespace com.ultrabit.bitheroes.ui.grid;

public class Grid2 : MonoBehaviour, IPointerDownHandler, IEventSystemHandler, IPointerUpHandler
{
	public enum MAP
	{
		TOWN,
		FISHING,
		GUILD
	}

	public GameObject pre;

	public Move Player;

	private string walkablesTEMP = "11111111111111111111111111111111111111111111111111111111111110001000111001111111111111111111111111111111100010001100011111111111111111111111111111111000100011000111111111111111111111111111111110000000110001111100000000011111111111111111100000001100011111100000000111111111111111111000000011000000000000000001111111111111011110000000000000000000000000011111111111110000000000000000000000000000000111111111111100000000000000000000000000000001111111111111000000000000000000000000000000011111111111110000000000000000000000000000000111111111111101111000000000000000000000000001111111111111111110000000000001111110000000011111111111111111100000000000011111100000000111111111111111111000000000000111111000000001111111111111111110000000000001111111110000011111111111111111100000000000011111111100000111111111111111111000000000000111111111000011111111100111111110000000000001111111110000111111111001111000000000000000011111111100001111111110011110000000000000000111111110000011111111100111111100000000000001111111110000111111111001111110000000000000011111111100001111111110011111100000000000000111111111000011111111100111111000000000000001111111110001111111110011111110000000000000011111111000011111111100111111100000000000000000000000000111111111011111111000000000000000000000000001111111110111111111000000000000000000000000011111111101111100000000000000000000000000000111111111011111001000000000000000000000000001111111100011110010000000000000000000000000011111110000111100100000000000000001111110000111111100001111001000000000000000100111100001111111000011110010000000000000000001111000001111110000111100100000000000000000011110000011111100001111000000000000000000000111100000111111000111110010000000000000000011111000001111110000111111100000011100000000011110000011111100000000000000001111100000000000000000011111000000000000000011111000000000000000000111110000000000000000111110000000000000000001111100000000000000001111100000000000000000011111000000000000000011111000000000000000000111110000111111100000011100000000011100000001111110011111101000000000000000000111100000011111100011111000000000000000000001111000000111110000111110000000000000000000011110000001111100001111100000000000000000001111100000011111100011111000000000000000001011000000000111111100111111100000000000000000110000000011111111001111111000000000000000001100000000111111100111111110000000000000000011000000001111111101111111100000000000000000110011100011111111011111111100000000000000001111111000111111110111111111000000000000000001111110001111111100111111110000000000000000001111100011111111001111111100000000000000000011111000111111111011111111000000000000000000111110001111111110011111110000000000000000001111100011111111100111111100000000000100000011111111111111111001111111000001000001000000111111111111111110011111110000011001111000001111111111111111100111111100000110011111111111111111111111111001111111000001100111111111111111111111111111111111111111111001111111111111111111111111111111111111111110011111111111111111111111111111111111111111100111111111111111111111111111111111111111111001111111111111111111111111000011100011001110011111111111111111111111111100000000000011000011111111111111111111111111110000000000110000000000000000111111111111011100000000011100000000000000001111111111110000000000000111000000000000000001111111111100000000000000000000000000000000011111111111110000000000000000000000000000000011111111111100000000000000000000000000000000111111111100000000000000000000011000000000001111111111010000000000000000000111100000000011111111110100000000000111000001111100000000111111111111000000000001110000011111100000001111111111111100000000011100000111111000000011111111111111000000000011000001111110000000111111111111111111111111111111111111111111111111";

	private string footstepsTEMP = "00000000000000000000000000002000000000000000000000000000000002222222222220000000000000000000000000000000022222222202200000000000000000000000000000000222222022222000000000000000000000000000000022222222222220000044444444400000000000000000222222222222200000044444444000000000000001002222222222222244444444444440000000000000330022220222222222444444444444400000000000003333333222222222224444444444444000000000000033333332222222222244444444444440000000000000333333322222222222444444444444400000000000003333333222222222224444444444444000000000000033003332222222222244444444444440000000000000110033322222222220000004444444400000000000001100333222222222200000044444444000000000000011003332222222222000000444444440000000000000110033322222222220000000004444400000000000001000333222222222200000000044444000000000000000023332222222222000000000444440000000011000042003322222222220000000004444000000000110000422222222222222200000000033330000000001100004222222222222222000000003333300000000011000000022222222222220000000003333000000000110000002222222222222200000000033330000000001100000022222222222222000000000333300000000011000000222222222222220000000003330000000001100000002222222222222200000000333300000000011000000022222222222222223333333333000000000100000000222222222222222233333333330000000001000000000222222222222222333333333300000000010000011122222222223222223333333333000000000100000110222222222232222233333333330000000011100001102222222222222222333333333300000001111000011022222223333332210000033333000000011110000110223323333333321011000333330000000111100001102333333333333311110003333330000001111000011013333333333333311100033333300000011110000111333333333333333111000333333000000111000001103333333333333333100003333330000001111000000033333300033333333300033333300000033333444443333330000033333333333322222200000333334444433333300000333333333333222332000003333344444333333000003333333333333222220000033333444443333330000033333333333333222200000333334444433333300000333333333333332222000003333000000033333300033333333300011111110000001100000010333333333333333311000011131100000011100000113333333333333331110000111311000001111000001113333333333333311100001113110000011110000011443333333333331110000011131100000011100000444443333333333110100111111311000000011000000044443333333111111001111144400000000110000000444444433333111110011111444000000011000000004444444333331111100111114440000000010000000044444443333311111001100044400000000100000000444444433333111110000000444000000001000000000444444333331111110000004440000000011000000004444443333311333310000044400000000110000000044444433333113333300000444000000000100000000444444333331133333000004440000000001100000004444443333311333330000044400000000011000000044444433331013333300000000000000000110000000444410333310133331000000000000000001100000004444104444000111110000000000000000011000000044441444440000000000000000000000000110000000444414444400000000000000000000000000000000000000044444000000000000000000000000000000000000000444440000000000000000000000000000000000000004444400000000000000000000000000000000000000044444000000000000000000000000111100011100110044440000000000000000000000000011111111111100333300000000000000000000000000001111111111003333333333333333330000000000100011111111100033333333333333333300000000001111111111111000333333333333333333000000000011111111111333333333333333333333330000000000001111111113333333333333333333333300000000000011111111133333333333333333333333000000000011111111111333333333333333333333330000000000101111111113333333333333333333333300000000001011111111111000333333333333333333000000000000111111111110003333333333333333330000000000000011111111100033333333333333333300000000000000111111111100333333333333333333000000000000000000000000000000330000000030000000";

	public int columns = 85;

	public int rows = 44;

	public float scale = 0.3f;

	public GridTile[,] gridArray;

	public GridTile[] gridList;

	public Vector3 topleft = new Vector3(0f, 0f, 0f);

	public MAP map;

	public GridTile start;

	public GridTile target;

	private bool testing;

	public List<GridTile> pathArray;

	public Dictionary<string, SpriteRenderer> pathTesting = new Dictionary<string, SpriteRenderer>();

	public GridPathfinderOLD gridPath;

	private float timeCount;

	private bool clickOnMap;

	public GameObject anim;

	private void Awake()
	{
		topleft = new Vector3((0f - GetComponent<SpriteRenderer>().bounds.size.x) / 2f, GetComponent<SpriteRenderer>().bounds.size.y / 2f);
		switch (map)
		{
		case MAP.TOWN:
			walkablesTEMP = "11111111111111111111111111111111111111111111111111111111111110001000111001111111111111111111111111111111100010001100011111111111111111111111111111111000100011000111111111111111111111111111111110000000110001111100000000011111111111111111100000001100011111100000000111111111111111111000000011000000000000000001111111111111011110000000000000000000000000011111111111110000000000000000000000000000000111111111111100000000000000000000000000000001111111111111000000000000000000000000000000011111111111110000000000000000000000000000000111111111111101111000000000000000000000000001111111111111111110000000000001111110000000011111111111111111100000000000011111100000000111111111111111111000000000000111111000000001111111111111111110000000000001111111110000011111111111111111100000000000011111111100000111111111111111111000000000000111111111000011111111100111111110000000000001111111110000111111111001111000000000000000011111111100001111111110011110000000000000000111111110000011111111100111111100000000000001111111110000111111111001111110000000000000011111111100001111111110011111100000000000000111111111000011111111100111111000000000000001111111110001111111110011111110000000000000011111111000011111111100111111100000000000000000000000000111111111011111111000000000000000000000000001111111110111111111000000000000000000000000011111111101111100000000000000000000000000000111111111011111001000000000000000000000000001111111100011110010000000000000000000000000011111110000111100100000000000000001111110000111111100001111001000000000000000100111100001111111000011110010000000000000000001111000001111110000111100100000000000000000011110000011111100001111000000000000000000000111100000111111000111110010000000000000000011111000001111110000111111100000011100000000011110000011111100000000000000001111100000000000000000011111000000000000000011111000000000000000000111110000000000000000111110000000000000000001111100000000000000001111100000000000000000011111000000000000000011111000000000000000000111110000111111100000011100000000011100000001111110011111101000000000000000000111100000011111100011111000000000000000000001111000000111110000111110000000000000000000011110000001111100001111100000000000000000001111100000011111100011111000000000000000001011000000000111111100111111100000000000000000110000000011111111001111111000000000000000001100000000111111100111111110000000000000000011000000001111111101111111100000000000000000110011100011111111011111111100000000000000001111111000111111110111111111000000000000000001111110001111111100111111110000000000000000001111100011111111001111111100000000000000000011111000111111111011111111000000000000000000111110001111111110011111110000000000000000001111100011111111100111111100000000000100000011111111111111111001111111000001000001000000111111111111111110011111110000011001111000001111111111111111100111111100000110011111111111111111111111111001111111000001100111111111111111111111111111111111111111111001111111111111111111111111111111111111111110011111111111111111111111111111111111111111100111111111111111111111111111111111111111111001111111111111111111111111000011100011001110011111111111111111111111111100000000000011000011111111111111111111111111110000000000110000000000000000111111111111011100000000011100000000000000001111111111110000000000000111000000000000000001111111111100000000000000000000000000000000011111111111110000000000000000000000000000000011111111111100000000000000000000000000000000111111111100000000000000000000011000000000001111111111010000000000000000000111100000000011111111110100000000000111000001111100000000111111111111000000000001110000011111100000001111111111111100000000011100000111111000000011111111111111000000000011000001111110000000111111111111111111111111111111111111111111111111";
			footstepsTEMP = "00000000000000000000000000002000000000000000000000000000000002222222222220000000000000000000000000000000022222222202200000000000000000000000000000000222222022222000000000000000000000000000000022222222222220000044444444400000000000000000222222222222200000044444444000000000000001002222222222222244444444444440000000000000330022220222222222444444444444400000000000003333333222222222224444444444444000000000000033333332222222222244444444444440000000000000333333322222222222444444444444400000000000003333333222222222224444444444444000000000000033003332222222222244444444444440000000000000110033322222222220000004444444400000000000001100333222222222200000044444444000000000000011003332222222222000000444444440000000000000110033322222222220000000004444400000000000001000333222222222200000000044444000000000000000023332222222222000000000444440000000011000042003322222222220000000004444000000000110000422222222222222200000000033330000000001100004222222222222222000000003333300000000011000000022222222222220000000003333000000000110000002222222222222200000000033330000000001100000022222222222222000000000333300000000011000000222222222222220000000003330000000001100000002222222222222200000000333300000000011000000022222222222222223333333333000000000100000000222222222222222233333333330000000001000000000222222222222222333333333300000000010000011122222222223222223333333333000000000100000110222222222232222233333333330000000011100001102222222222222222333333333300000001111000011022222223333332210000033333000000011110000110223323333333321011000333330000000111100001102333333333333311110003333330000001111000011013333333333333311100033333300000011110000111333333333333333111000333333000000111000001103333333333333333100003333330000001111000000033333300033333333300033333300000033333444443333330000033333333333322222200000333334444433333300000333333333333222332000003333344444333333000003333333333333222220000033333444443333330000033333333333333222200000333334444433333300000333333333333332222000003333000000033333300033333333300011111110000001100000010333333333333333311000011131100000011100000113333333333333331110000111311000001111000001113333333333333311100001113110000011110000011443333333333331110000011131100000011100000444443333333333110100111111311000000011000000044443333333111111001111144400000000110000000444444433333111110011111444000000011000000004444444333331111100111114440000000010000000044444443333311111001100044400000000100000000444444433333111110000000444000000001000000000444444333331111110000004440000000011000000004444443333311333310000044400000000110000000044444433333113333300000444000000000100000000444444333331133333000004440000000001100000004444443333311333330000044400000000011000000044444433331013333300000000000000000110000000444410333310133331000000000000000001100000004444104444000111110000000000000000011000000044441444440000000000000000000000000110000000444414444400000000000000000000000000000000000000044444000000000000000000000000000000000000000444440000000000000000000000000000000000000004444400000000000000000000000000000000000000044444000000000000000000000000111100011100110044440000000000000000000000000011111111111100333300000000000000000000000000001111111111003333333333333333330000000000100011111111100033333333333333333300000000001111111111111000333333333333333333000000000011111111111333333333333333333333330000000000001111111113333333333333333333333300000000000011111111133333333333333333333333000000000011111111111333333333333333333333330000000000101111111113333333333333333333333300000000001011111111111000333333333333333333000000000000111111111110003333333333333333330000000000000011111111100033333333333333333300000000000000111111111100333333333333333333000000000000000000000000000000330000000030000000";
			break;
		case MAP.FISHING:
			walkablesTEMP = "1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111110000111111111111111111111111111111111111111111111111111111111111111111000011111111111111111111111111111111111111111111111111111111111111111100001111111111111111111111111111111111111111111111111111111111111111110000111111111111111111111111111111111111111111111111111111111111111111000011111111111111111111111111111111111111111111111111111111111111111100001111111111111111111111111111111100011111111111000011111111111111110000111111111111111111111111111111110001111111111100001111111111111111000011111111111111111111111111111111000111111111110000111111111111111100001111111111111111111111111111111100001111111111000011111111111111110000111111111111111111111111111111110000111111111100001111111110011111000001111111111111111111111111111111000011111111110000111111000001111100000111111111111111111111111111111100001111111111000011111000000111110000111111111111111111111111111111110000111111111100001110000000111111100001111111111111111111111111111111000011111111110000111000000111111110000111111111111111111111111111111110001111111000000011100000011111111000011111111111111111111111111111111000111100000000000000000011111111100001111111111111111111111111111111100000000000000000000000001111111110001111111111111111111111110111111110000000000000000000000001111111110000011111111111111111111110001111111000000000000000000000000111111111000001111111111111111111111000111111110000000000000000000000011111111100000111111111111111111110000011111111111110000000000000000001111111110000111111111111111111110000011111111111111000000000000000000111111111000011111111111111111111000000111111111111000000000000000000001111111110000111111111111111111100000011111111111100000000000000000000011111111000011111111111111111111000001111111111110000000000000000000001111111100001111111111111111111100000111111111111000000000000000000000111111110001111111111111111111110000111111111111100000000000000000000111111111000111111111111111111111000011111111111110000000000000000011111111111100001111111111111111111100000111111111111000000000000000011111111111110000111111111111111111110000001111111111100000000000000011111111111111000011111111111111111111000000011111111110000000000000001111111111111100011111111111111111111100000000011111111000000000000000111111111111100001111111111111111111111000000001111111100000000000000011111111111110000011111111111111111111100000000111111110000000000000001111111111000000001111111111111111111111110000011111111000000000000000011100000000000000111111111111111111111110000001111111000000000000000000000000000000000111111111111111111111111000000111111100000000000000000000000000000000011111111111111111111111100000011111111000000000000000000000000100000001111111111111111111111111000001111111000000000000000001111111111110000111111111111111111111111110000111111100000110000000000111111111111000011111111111111111111111111110011111111000011000000000001111111111110001111111111111111111111111111000000000000001110000000000011111111111000111111111111111111111111111000000000000000011000000000001111111111100011111111111111111111111111100000000000000000000000000001111111111110001111111111111111111111111110000000000000000000000000011111111111111000111111111111111111111111111000000000000000000000000001101111111111111111111111111111111111111111110000000000000000000000000000111111111111111111111111111110001111111111101100000000000000000000000011111111111111111111111111111000111111111111110000000000000000000000001111111111111111111111111111100011111111111111000000000000000000000000011111111111111111111111111110001111111111111000000000000000000000000001111111111111111111111111111000111111111111100000000000000000000000001111111111111111111111111111100011111111111110000000000000000000000000110001111111111111111111111110000111111111111000000000000000000000000000000111111111111111111111111000001111111110000000000000000000011000000000011111111111111111111111100000111111111000000000000000000001100000000001111111111111111111111110000000000000000000000000000000000110000000001111111111111111111111111000000000000000000000000000000000000000000001111111111111111111111111100000000000000000000000000000000000000000000111111111111111111111111111000000000000000110000000000000000001100000001111111111111111111111111100000000000000111100000000000000000110000000111111111111111111111111111000111111111111111000000000000000011111000011111111111111111111111111100011111111111111110000000000000000111110001111111111111111111111111100001111111111111111110000000000000111111000111111111111111111111111111000011111111111111111000000000000111111100001111111111111111111111111100000111111111111111100000000111111111110000111111111111111111111111100000011111111111111110000000111111111111000001111111111111111111111110000001111111111111111000000011111111111110000111111111111111111111111000000011111111111111100000001111111111111000011111111111111111111111110000001111111111111110000000111111111111100011111111111111111111111111000000111111111111111000000111111111111111111111111111111111111111111110000011111111111111000000011111111111111111111111111111111111111111111000001111111111111100001001111111111111111111111111111111111111111111100000111111111111110000100111111111111111111111111111111111111111111110000011111111111111000010011111111111111111111111111111111111111111111000001111111111111100001000111111111111111111111111111111111111111111000000111111111111110000100001111111111111111111111111111111111110000000000111111111111111011110000111111111111111111111111111111111111000000011111111111111111101111000011111111111111111111111111111111111100111000111111111111111110011100001111111111111111111111111111111111110011100001111111111111111000110000111111111111111111111111111111111111111110000111111111111111100001000001111111111111111111111111111111111111111000011111111111111111000100000111111111111111111111111111111111111111100011111111111111111100010010011111111111111111111111111111111111111110011111111111111111111001011001111111111111111111111111111111111111111111111111111111111111111001111111111111111111111111111111111111111111111111111111111111111111100111111111111111111111111111111111111111111111111111111111111111111110011111111111111111111111111111111111111111111111111111111111111111111001111111111111111111111111111111111111111111111111111111111111111111100111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111";
			footstepsTEMP = "2222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222224444222222222222222222222222222222222222222222222222222222222222222222444422222222222222222222222222222222222222222222222222222222222222222244442222222222222222222222222222222222222222222222222222222222222222224444222222222222222222222222222222222222222222222222222222222222222222444422222222222222222222222222222222222222222222222222222222222222222244442222222222222222222222222222222244422222222222111122222222222222224444222222222222222222222222222222224442222222222211112222222222222222444422222222222222222222222222222222444222222222221111222222222222222244442222222222222222222222222222222244442222222222111122222222222222224444222222222222222222222222222222224444222222222211112222222223322222444442222222222222222222222222222222444422222222221111222222333332222244444222222222222222222222222222222244442222222222111122222333333222224444222222222222222222222222222222224444222222222212212223333333222222244442222222222222222222222222222222444422222222222222222133333222222224444222222222222222222222222222222224442222222222222222213333322222222444422222222222222222222222222222222444222222222222222222133322222222244442222222222222222222222222222222244444422222222222222222132222222224442222222222222222222222223322222224444442442222222222222222222222224444422222222222222222222223332222222444444244222222222232222222222222444442222222222222222222222333222222224444424422222222222322222222222244444222222222222222222223333322222222222222222222221112332222222222224444222222222222222222223333322222222222222222244222111233322222222222444422222222222222222222333333222222222222222224422211122332222222222224444222222222222222222233333322222222222222222244221112223222222222222444422222222222222222222333332222222222223322244222111222322222222222244442222222222222222222233333222222222222332224422211222222222222222224442222222222222222222223333222222222222233322244222122222222222222222444222222222222222222222333322222222222222322222222222222222222222222244442222222222222222222233333222222222222223222222222222222222222222224444222222222222222222223333332222222222223322244432222322222222222222444422222222222222222222333333322222222222222224443223332222222222222244422222222222222222222233333333222222222222222244222332222222222222244442222222222222222222222333333322222222222222224422233222222222222224444422222222222222222222233333332222222222232222224422222222222222444444442222222222222222222222222333222222222333222224444242222244444444444444222222222222222222222222223322222222333222222244424221444444444444444222222222222222222222222222232222222222222222222242422144444444444444422222222222222222222222222222222222222222222222222223214444444244444442222222222222222222222222222222222222222223332222222232224222222224444222222222222222222222222222222222222222223223322222222222222222222444422222222222222222222222222222222222222222322332222322222222222222224442222222222222222222222222222222222222222232223222222222222222222222444222222222222222222222222222222322222222222322222233322222222222222244422222222222222222222222222233332222222222222222223332222222222222224442222222222222222222222222223332222222222222222222223322222222222222444222222222222222222222222222232222222222222222222222232222222222222222222222222222222222222222222222222222222222222222222223222222222222222222222222222222224442222222222222222222222222222222222222222222222222222222222222222222444222222222222222222442222222222222222222222222222222222222222222222244422222222222222222444222222222222222332222222222222222222222222222224442222222222222222244422222222222222333222222222222222222222222222222444222222222222222222444222222222222333322222222222222222222222222222244422222222222222232444222222222222233322222222222222222222222222222223333222222222222223244222222222222222333322222222222222222222222222222333332222222222222222222222222222222233332222222222222222222222222222233333222222222222442322222222222222222333222222222222222222222222222223333333333333332244432222222222222222233332222222222222222222222222222333333333333333224442322222222222232222332222222222222222222222222222233333333333333332442222222222222333222233332222222222222222222222222222333333333333333222222222222222233222222233222222222222222222222222222233333333333333222222222221122222222222222333222222222222222222222222222333222222222222222222222112222222222222233322222222222222222222222222233322222222222222222222211222222222222223332222222222222222222222222233332222222222222222221111122222222222222333222222222222222222222222222333322222222222222222111111222222222222233332222222222222222222222222233333222222222222222211111111222222222223333222222222222222222222222233333322222222222222221111111222222222222333322222222222222222222222223333332222222222222222111111122222222222223332222222222222222222222222333333322222222222222211111112222222222222333222222222222222222222222223333332222222222222221111111222222222222233322222222222222222222222222333333222222222222222111111222222222222222222222222222222222222222222223333322222222222222111111122222222222222222222222222222222222222222222333332222222222222211112112222222222222222222222222222222222222222222233333222222222222221111211222222222222222222222222222222222222222222233333322222222222222111121122222222222222222222222222222222222222222223333332222222222222211112111222222222222222222222222222222222222222222333333222222222222221111211112222222222222222222222222222222222223333333333222222222222222122221111222222222222222222222222222222222222333333322222222222222222212222111122222222222222222222222222222222222233222333222222222222222221122211112222222222222222222222222222222222223322233332222222222222222111221111222222222222222222222222222222222222222223333222222222222222211112111112222222222222222222222222222222222222222333322222222222222222111211111222222222222222222222222222222222222222233322222222222222222211121121122222222222222222222222222222222222222223322222222222222222222112122112222222222222222222222222222222222222222222222222222222222222222112222222222222222222222222222222222222222222222222222222222222222222211222222222222222222222222222222222222222222222222222222222222222222221122222222222222222222222222222222222222222222222222222222222222222222112222222222222222222222222222222222222222222222222222222222222222222211222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222";
			break;
		}
		GenerateGrid();
	}

	private void GenerateGrid()
	{
		int num = 0;
		topleft = new Vector3((0f - GetComponent<SpriteRenderer>().bounds.size.x) / 2f, GetComponent<SpriteRenderer>().bounds.size.y / 2f);
		if (gridArray != null)
		{
			return;
		}
		gridArray = new GridTile[columns, rows];
		gridList = new GridTile[columns * rows];
		for (int i = 0; i < columns; i++)
		{
			for (int j = 0; j < rows; j++)
			{
				GridTile gridTile = new GridTile(num, i, j, int.Parse(walkablesTEMP[num].ToString()), int.Parse(footstepsTEMP[num].ToString()));
				gridArray[i, j] = gridTile;
				gridList[gridTile.id] = gridTile;
				if (testing)
				{
					GameObject gameObject = UnityEngine.Object.Instantiate(pre, new Vector3(topleft.x + scale * (float)i, topleft.y - scale * (float)j, topleft.z), Quaternion.identity);
					gameObject.transform.parent = base.transform;
					gameObject.transform.GetChild(0).GetComponent<TextMeshPro>().text = i + "," + j;
					pathTesting.Add(gridTile.x + "," + gridTile.y, gameObject.transform.GetChild(1).GetComponent<SpriteRenderer>());
					if (gridTile.walkable == 0)
					{
						pathTesting[gridTile.x + "," + gridTile.y].color = new Color32(0, byte.MaxValue, 0, 50);
					}
					else
					{
						pathTesting[gridTile.x + "," + gridTile.y].color = new Color32(byte.MaxValue, 0, 0, 50);
					}
				}
				num++;
			}
		}
		gridPath = new GridPathfinderOLD();
	}

	private void CallPathfinding()
	{
		if (gridPath == null)
		{
			return;
		}
		if (start == null)
		{
			start = gridArray[7, 23];
		}
		if (testing && pathArray != null)
		{
			for (int i = 0; i < pathArray.Count; i++)
			{
				pathTesting[pathArray[i].x + "," + pathArray[i].y].color = new Color32(0, byte.MaxValue, 0, 50);
			}
		}
		gridPath.UltraGetPatch(start, target);
		if (testing && pathArray != null && pathArray.Count > 0)
		{
			for (int j = 0; j < pathArray.Count; j++)
			{
				pathTesting[pathArray[j].x + "," + pathArray[j].y].color = new Color32(0, 0, 0, 100);
			}
			MonoBehaviour.print("New Start: [" + start.x + "," + start.y + "]");
		}
	}

	private void MoveTo(Vector2 pointerPos, GameObject click = null)
	{
		RaycastHit2D raycastHit2D = Physics2D.Raycast(GameData.instance.main.mainCamera.ScreenToWorldPoint(Input.mousePosition), Vector2.zero);
		if (!raycastHit2D)
		{
			return;
		}
		int num = (int)Math.Floor(raycastHit2D.point.x * 100f / 30f + topleft.x * 100f / 30f * -1f);
		int num2 = (int)(0.0 - Math.Floor(raycastHit2D.point.y * 100f / 30f - topleft.y * 100f / 30f)) - 1;
		if (start == null)
		{
			start = gridArray[7, 23];
		}
		if (raycastHit2D.collider.name == "Grid")
		{
			target = gridArray[num, num2];
			if (click != null)
			{
				click.transform.position = new Vector3(raycastHit2D.point.x, raycastHit2D.point.y, 0f);
			}
			Player.targetNPC = null;
		}
		if (testing)
		{
			pathTesting[start.x + "," + start.y].color = new Color32(0, byte.MaxValue, 0, 200);
			pathTesting[target.x + "," + target.y].color = new Color32(0, 0, byte.MaxValue, 200);
		}
		CallPathfinding();
	}

	public void MoveTo(GridTile _target)
	{
		target = _target;
		if (testing)
		{
			pathTesting[start.x + "," + start.y].color = new Color32(0, byte.MaxValue, 0, 200);
			pathTesting[target.x + "," + target.y].color = new Color32(0, 0, byte.MaxValue, 200);
		}
		CallPathfinding();
	}

	public void OnPointerDown(PointerEventData eventData)
	{
		GameObject click = UnityEngine.Object.Instantiate(anim);
		MoveTo(eventData.position, click);
		clickOnMap = true;
	}

	public void OnPointerUp(PointerEventData eventData)
	{
		clickOnMap = false;
	}

	private void Update()
	{
		if (clickOnMap)
		{
			timeCount += Time.deltaTime;
			if (timeCount > 0.2f)
			{
				MoveTo(Input.mousePosition);
				timeCount = 0f;
			}
		}
	}
}
